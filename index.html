<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feather Dash - Home</title>
  <link rel="stylesheet" href="css/game.css" />

  <!-- Firebase (optional for solo stats) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js"></script>

  <style>
    .hidden { display: none; }
  </style>
</head>
<body class="lobby-page">
  <div class="lobby-container">
    <h1>Feather Dash</h1>

    <!-- Step 1: Main Menu -->
    <div id="mainMenu">
      <button id="soloBtn">Solo</button>
      <button id="multiplayerBtn">Multiplayer</button>
    </div>

    <!-- Step 2: Solo Menu -->
    <div id="soloMenu" class="hidden">
      <button onclick="window.location.href='time-trial.html'">Time-Trial</button>
      <button onclick="window.location.href='endless.html'">Endless</button>
      <button onclick="goBackToMain()">Back</button>
    </div>
  </div>

  <!-- ðŸ”Š Volume Button (Bottom-Right) -->
  <button id="volumeBtn">ðŸ”Š</button>

  <!-- ðŸŽµ Audio -->
  <audio id="bgm" src="assets/bgm.mp3" loop preload="auto"></audio>

  <script>
    const mainMenu = document.getElementById('mainMenu');
    const soloMenu = document.getElementById('soloMenu');

    const bgm = document.getElementById('bgm');
    const volumeBtn = document.getElementById('volumeBtn');

    // =========================
    // Volume Control
    // =========================
    const volumeLevels = [0.25, 0.5, 0.75, 1, 0]; // 0 = mute
    const volumeIcons  = ['ðŸ”‰', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ”Š', 'ðŸ”‡'];
    let currentVolumeIndex = 0; // start at 100% volume

    // Restore last volume if saved
    const savedVolume = localStorage.getItem('featherVolumeIndex');
    if (savedVolume !== null) currentVolumeIndex = parseInt(savedVolume, 10);

    bgm.volume = volumeLevels[currentVolumeIndex];
    volumeBtn.textContent = volumeIcons[currentVolumeIndex];

    volumeBtn.addEventListener('click', () => {
      currentVolumeIndex = (currentVolumeIndex + 1) % volumeLevels.length;
      bgm.volume = volumeLevels[currentVolumeIndex];
      volumeBtn.textContent = volumeIcons[currentVolumeIndex];
      localStorage.setItem('featherVolumeIndex', currentVolumeIndex);
    });

    // =========================
    // Menu Logic
    // =========================
    document.getElementById('soloBtn').onclick = () => {
      mainMenu.classList.add('hidden');
      soloMenu.classList.remove('hidden');
    };

    document.getElementById('multiplayerBtn').onclick = () => {
      window.location.href = 'lobby.html';
    };

    function goBackToMain() {
      soloMenu.classList.add('hidden');
      mainMenu.classList.remove('hidden');
    }

    // =========================
    // Autoplay on Load
    // =========================
    function startBGM() {
      if (bgm.paused) {
        bgm.currentTime = 0;
        bgm.play().catch(() => {
          console.log("Autoplay blocked. Will start on first click.");
        });
      }
    }

    // Try autoplay on page load
    window.addEventListener('load', () => {
      startBGM();
    });

    // Fallback: start on first interaction if blocked
    document.body.addEventListener('click', startBGM, { once: true });
  </script>
</body>
</html>
